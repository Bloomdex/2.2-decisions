# Documentation

## Specifications

The client requested the following features to be implemented:

* Data-connection between the vps and the raspberry pi has to be encrypted
* Historical data should be visible of the last-month
* Data needs to be reported to the raspberry-pi every 10 seconds (+- 80.000 measurements).
* A Map with locations of weather-stations in South-America
* A web-app with the colors of the client-company
* First sight should be Top 10 Locations for planting roses and a map of South-America with possible growing locations.
* Should show: Rainfall, (peak) temperatures and humidity
* Support for low-bandwith internet
* Metric system as unit of measurement
* Three levels of authentication

## Operating System Virtual Machine

The operating system we've chosen to run the Database and website on is: Ubuntu Server 18.04 LTS
Because there is a lot of documentation online to setup the operating system and it is a long-term release, which means the operating itself does not change much apart from security-updates. The underlying OS did not matter a lot to us, as long it supported recent versions of Docker.

## Operating System Raspberry Pi

...

## JVM Raspberry Pi

...

## Transportation of data between VM and Raspberry Pi

Transportation of information between the raspberry pi and the VM is done using a TLSv1.2, Because the customer required a encrypted connection between the client and the server. We don't use rsync and mounted drives because we wanted a fast way to get data from the raspberry-pi to the vps-database. To get this fast-connection we decided to not use any storage-medium until the end of the information transport chain.

## Approachability Raspberry Pi to VM

In order for the raspberry pi and the vm to know eachothers ip-adresses we've setup Dynamic name records updating using a curl to an API of the dns-server on both the VM and the Raspberry Pi, This way, instead of using an IP-adress directly, they use  DNS-server first to retrieve the ip-adress from there.

## Configuration Changes

### VM

- **DNS:** We've added a systemd unit to the VM, which performs a curl to the api of our domain-provider to update it's A Record to the newly allocated ip-adress. This way to server is always accessable using the domain-name.

- **Docker** We've installed the `docker.io` package on the VM in order to be able to run our own docker-containers.

	- There are in total 3 docker containers installed on the VM, The database, The website and an automated nginx reverse proxy.
	- On the docker-container for the database, openjdk's jre8-alpine is used as a base-image.

- **Certbot:** We've installed certbot inorder to generate https-certificates for use on our website. Certbot automatically updates these certificates when they are in 30 days of renewal.

- **SSH:** We've removed the SSH-key that was generated by school, and created our own instead for security reasons.

### Raspberry Pi

...

### Correction & Synchronization

...

### Storage type

- The data is stored in a hibernated h2-database, h2-database files are automatically encrypted and small in size and is stored on the storage-device of the VM.

## Presentation

* We've build a RESTful-API in order to retrieve information from the database, This API requires http-basic-authentication to be accessed (with different levels of authentication).
* The website is build using type-script and react and runs on nginx, the website does RESTful API-requests to the database in order to function.
* The map on the website is made using open-street-maps and pigeon-maps
* The graph on the website is made using recharts

## Stress-test

The first stress test using 650 Clusters performed successfully:

![](images/stress-test-1.png)

After optimizing the code by removing unneeded calculations and variables we've managed to get to 800 Clusters per seconds successfully:

![](images/stress-test-2.png)

## Code And Installation Instructions:

* Website: [https://github.com/Bloomdex/2.2-website](https://github.com/Bloomdex/2.2-website)
* Filter-Station: [https://github.com/Bloomdex/2.2-pi-weather-station](https://github.com/Bloomdex/2.2-pi-weather-station)
* Database: [https://github.com/Bloomdex/2.2-vps-database](https://github.com/Bloomdex/2.2-vps-database)
* Presentation: [https://github.com/Bloomdex/2.2-docs/blob/master/documents/formal_meeting_2_presentation.pdf](https://github.com/Bloomdex/2.2-docs/blob/master/documents/formal_meeting_2_presentation.pdf)
